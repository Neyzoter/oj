define2(["services/proctoring/proctoringProviderFactory","services/testWindowConstants","services/proctoringService","../constants/proctoringConstants"],function(){var c=angular.module("mettl");c.register.directive("chatDirective",["ProctoringProviderFactory","ProctoringConstants","TestWindowConstants","ProctoringService","$timeout","$sce",function(e,c,f,k,l,m){return{restrict:"A",templateUrl:"/partials/candidateChatTemplate",scope:{groupId:"\x3dgroupId",isTestPaused:"\x3disTestPaused",uniqueId:"\x3duniqueId",
clientId:"\x3dclientId"},link:function(a,n,h){function g(){l(function(){var a=$(n),b=a.find(".chat-body");b.scrollTop(b.prop("scrollHeight"));a.find(".chat-textarea")[0].focus()},1)}a.chatMessages=[];a.previousMessagesAvailable=!0;a.showChat=!1;var p=e.getCommunicationProvider();h=c.AppletMessageType;var q=String.format(f.Url.fetchChatHistoryUrl,a.uniqueId,a.groupId,a.clientId)+"\x26callback\x3dJSON_CALLBACK";a.newChat=function(d){d&&(a.chatMessages.push({message:d,name:"Me",timeStamp:(new Date).getTime()}),
p.sendChatMessage(escape(d)),g())};a.$on(h.PAUSE_TEST,function(d,b){a.$apply(function(){a.showChat=!0;a.chatBoxClass="classic-green"})});a.$on(h.MESSAGE,function(d,b){a.$apply(function(){a.chatBoxClass=a.showChat?"classic-green":"classic-blue";a.chatMessages.push({message:m.trustAsHtml(b.message),name:"Proctor",timeStamp:b.timeStamp});a.showChat&&g()})});a.toggleChatBox=function(){a.isTestPaused&&a.showChat||(a.showChat=!a.showChat,a.chatBoxClass=a.showChat?"classic-green":"",a.showChat&&g())};a.loadEarlierMessage=
function(){a.loadingPreviousMessages=!0;k.fetchChatHistory(q).then(function(d){a.previousMessagesAvailable=0<d.data.length;a.loadingFinished=!0;a.loadingPreviousMessages=!1;a.chatMessages=[];angular.forEach(d.data,function(b){a.chatMessages.push({name:"0"==b.from.split("_")[0]?"Me":"Proctor",timeStamp:new Date(b.timestamp),message:unescape(b.message)})});g();a.showChat=!0},function(){a.loadingPreviousMessages=!1})}}}}]);c.register.directive("ngEnter",function(){return function(e,c,f){f.$$element.bind("keydown keypress",
function(c){if(13===c.which||13===c.keyCode)e.$apply(function(){e.$eval(f.ngEnter);e.newChatMessage=""}),c.preventDefault()})}})});