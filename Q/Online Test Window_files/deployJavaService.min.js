define2([],function(){angular.module("mettl").register.service("DeployJavaService",function(){var f=function(){function c(a){n.debug&&(console.log?console.log(a):alert(a))}function k(a){if(null==a||0==a.length)return"http://java.com/dt-redirect";"\x26"==a.charAt(0)&&(a=a.substring(1,a.length));return"http://java.com/dt-redirect?"+a}var d=["id","class","title","style"];"classid codebase codetype data type archive declare standby height width usemap name tabindex align border hspace vspace".split(" ").concat(d,
["lang","dir"],"onclick ondblclick onmousedown onmouseup onmouseover onmousemove onmouseout onkeypress onkeydown onkeyup".split(" "));var l="codebase code name archive object width height alt align hspace vspace".split(" ").concat(d),h;try{h=-1!=document.location.protocol.indexOf("http")?"//java.com/js/webstart.png":"http://java.com/js/webstart.png"}catch(p){h="http://java.com/js/webstart.png"}var n={debug:null,version:"20120801",firefoxJavaVersion:null,myInterval:null,preInstallJREList:null,returnPage:null,
brand:null,locale:null,installType:null,EAInstallEnabled:!1,EarlyAccessURL:null,oldMimeType:"application/npruntime-scriptable-plugin;DeploymentToolkit",mimeType:"application/java-deployment-toolkit",launchButtonPNG:h,browserName:null,browserName2:null,getJREs:function(){var a=[],b=this.getBrowser();console.log(b);"MSIE"==b?(console.log("checking with 1.8"),this.testUsingActiveX("1.8.0")?a[0]="1.8.0":this.testUsingActiveX("1.7.0")?a[0]="1.7.0":this.testUsingActiveX("1.6.0")?a[0]="1.6.0":this.testUsingActiveX("1.5.0")?
a[0]="1.5.0":this.testUsingActiveX("1.4.2")?a[0]="1.4.2":this.testForMSVM()&&(a[0]="1.1")):"Netscape Family"==b&&(this.getJPIVersionUsingMimeType(),null!=this.firefoxJavaVersion?a[0]=this.firefoxJavaVersion:this.testUsingMimeTypes("1.7")?a[0]="1.7.0":this.testUsingMimeTypes("1.6")?a[0]="1.6.0":this.testUsingMimeTypes("1.5")?a[0]="1.5.0":this.testUsingMimeTypes("1.4.2")?a[0]="1.4.2":"Safari"==this.browserName2&&(this.testUsingPluginsArray("1.7.0")?a[0]="1.7.0":this.testUsingPluginsArray("1.6")?a[0]=
"1.6.0":this.testUsingPluginsArray("1.5")?a[0]="1.5.0":this.testUsingPluginsArray("1.4.2")&&(a[0]="1.4.2")));if(this.debug)for(b=0;b<a.length;++b)c("[getJREs()] We claim to have detected Java SE "+a[b]);console.log("JREs are:");console.log(a);return a},installJRE:function(a,b){if(this.isPluginInstalled()&&this.isAutoInstallEnabled(a)){var e=!1;if(e=this.isCallbackSupported()?this.getPlugin().installJRE(a,b):this.getPlugin().installJRE(a))this.refresh(),null!=this.returnPage&&(document.location=this.returnPage);
return e}return this.installLatestJRE()},isAutoInstallEnabled:function(a){if(!this.isPluginInstalled())return!1;"undefined"==typeof a&&(a=null);if("MSIE"!=f.browserName||f.compareVersionToPattern(f.getPlugin().version,["10","0","0"],!1,!0))a=!0;else if(null==a)a=!1;else{var b="1.6.0_33+";if(null==b||0==b.length)a=!0;else{var e=b.charAt(b.length-1);"+"!=e&&"*"!=e&&-1!=b.indexOf("_")&&"_"!=e&&(b+="*",e="*");b=b.substring(0,b.length-1);if(0<b.length){var c=b.charAt(b.length-1);if("."==c||"_"==c)b=b.substring(0,
b.length-1)}a="*"==e?0==a.indexOf(b):"+"==e?b<=a:!1}a=!a}return a},isCallbackSupported:function(){return this.isPluginInstalled()&&this.compareVersionToPattern(this.getPlugin().version,["10","2","0"],!1,!0)},installLatestJRE:function(a){if(this.isPluginInstalled()&&this.isAutoInstallEnabled()){var b=!1;if(b=this.isCallbackSupported()?this.getPlugin().installLatestJRE(a):this.getPlugin().installLatestJRE())this.refresh(),null!=this.returnPage&&(document.location=this.returnPage);return b}a=this.getBrowser();
b=navigator.platform.toLowerCase();if("true"==this.EAInstallEnabled&&-1!=b.indexOf("win")&&null!=this.EarlyAccessURL)this.preInstallJREList=this.getJREs(),null!=this.returnPage&&(this.myInterval=setInterval("java_utils.poll()",3E3)),location.href=this.EarlyAccessURL;else{if("MSIE"==a)return this.IEInstall();if("Netscape Family"==a&&-1!=b.indexOf("win32"))return this.FFInstall();location.href=k((null!=this.returnPage?"\x26returnPage\x3d"+this.returnPage:"")+(null!=this.locale?"\x26locale\x3d"+this.locale:
"")+(null!=this.brand?"\x26brand\x3d"+this.brand:""))}return!1},runApplet:function(a,b,e,q,m){if("undefined"==e||null==e)e="1.1";q=e.match("^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?$");null==this.returnPage&&(this.returnPage=document.location);null!=q?this.writeAppletTag(a,b):c("[runApplet()] Invalid minimumVersion argument to runApplet():"+e)},reloadApplet:function(){$("#appletContainer").hide().show()},writeAppletTag:function(a,b){var e="\x3capplet ",c="",m=!0;if(null==b||"object"!=typeof b)b=
{};for(var d in a){var g;a:{g=d.toLowerCase();for(var k=l.length,h=0;h<k;h++)if(l[h]===g){g=!0;break a}g=!1}g?(e+=" "+d+'\x3d"'+a[d]+'"',"code"==d&&(m=!1)):b[d]=a[d]}d=!1;for(var f in b){"codebase_lookup"==f&&(d=!0);if("object"==f||"java_object"==f||"java_code"==f)m=!1;c+="\x3cparam name\x3d'"+f+"' value\x3d'"+b[f]+"'/\x3e"}d||(c+="\x3cparam name\x3d'codebase_lookup' value\x3d'false'/\x3e");m&&(e+=' code\x3d"dummy"');e+="\x3e";$("#appletContainer").html(e+"\n"+c+"\n\x3c/applet\x3e")},versionCheck:function(a,
b){var e=0,d=a.match("^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?(\\*|\\+)?$");if(null!=d){for(var m=!1,k=!1,g=[],f=1;f<d.length;++f)"string"==typeof d[f]&&""!=d[f]&&(g[e]=d[f],e++);"+"==g[g.length-1]?(k=!0,m=!1,g.length--):"*"==g[g.length-1]?(k=!1,m=!0,g.length--):4>g.length&&(k=!1,m=!0);b||(b=this.getJREs());for(f=0;f<b.length;++f)if(this.compareVersionToPattern(b[f],g,m,k))return!0;console.log("jre installed are "+b)}else e="Invalid versionPattern passed to versionCheck: "+a,c("[versionCheck()] "+
e),alert(e);return!1},isWebStartInstalled:function(a){if("?"==this.getBrowser())return!0;if("undefined"==a||null==a)a="1.4.2";var b=!1;null!=a.match("^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?$")?b=this.versionCheck(a+"+"):(c("[isWebStartInstaller()] Invalid minimumVersion argument to isWebStartInstalled(): "+a),b=this.versionCheck("1.4.2+"));return b},getJPIVersionUsingMimeType:function(){for(var a=0;a<navigator.mimeTypes.length;++a){var b=navigator.mimeTypes[a].type.match(/^application\/x-java-applet;jpi-version=(.*)$/);
if(null!=b&&(this.firefoxJavaVersion=b[1],"Opera"!=this.browserName2))break}},launchWebStartApplication:function(a){navigator.userAgent.toLowerCase();this.getJPIVersionUsingMimeType();if(0==this.isWebStartInstalled("1.7.0")&&(0==this.installJRE("1.7.0+")||0==this.isWebStartInstalled("1.7.0")))return!1;var b=null;document.documentURI&&(b=document.documentURI);null==b&&(b=document.URL);var e=this.getBrowser(),c;"MSIE"==e?c='\x3cobject classid\x3d"clsid:8AD9C840-044E-11D1-B3E9-00805F499D93" width\x3d"0" height\x3d"0"\x3e\x3cPARAM name\x3d"launchjnlp" value\x3d"'+
a+'"\x3e\x3cPARAM name\x3d"docbase" value\x3d"'+b+'"\x3e\x3c/object\x3e':"Netscape Family"==e&&(c='\x3cembed type\x3d"application/x-java-applet;jpi-version\x3d'+this.firefoxJavaVersion+'" width\x3d"0" height\x3d"0" launchjnlp\x3d"'+a+'"docbase\x3d"'+b+'" /\x3e');"undefined"==document.body||null==document.body?($("#appletContainer").html(c),document.location=b):(a=document.createElement("div"),a.id="div1",a.style.position="relative",a.style.left="-10000px",a.style.margin="0px auto",a.className="dynamicDiv",
a.innerHTML=c,document.body.appendChild(a))},createWebStartLaunchButtonEx:function(a,b){null==this.returnPage&&(this.returnPage=a);var e='\x3ca href\x3d"'+("javascript:deployJava.launchWebStartApplication('"+a+"');")+'" onMouseOver\x3d"window.status\x3d\'\'; return true;"\x3e\x3cimg src\x3d"'+this.launchButtonPNG+'" border\x3d"0" /\x3e\x3c/a\x3e';$("#appletContainer").html(e)},createWebStartLaunchButton:function(a,b){null==this.returnPage&&(this.returnPage=a);var e="javascript:if (!deployJava.isWebStartInstalled(\x26quot;"+
b+"\x26quot;)) {if (deployJava.installLatestJRE()) {if (deployJava.launch(\x26quot;"+a+"\x26quot;)) {}}} else {if (deployJava.launch(\x26quot;"+a+"\x26quot;)) {}}";document.getElementById("appletContainer").insertAdjacentHTML("afterbegin",'\x3ca href\x3d"'+e+'" onMouseOver\x3d"window.status\x3d\'\'; return true;"\x3e\x3cimg src\x3d"'+this.launchButtonPNG+'" border\x3d"0" /\x3e\x3c/a\x3e')},launch:function(a){document.location=a;return!0},isPluginInstalled:function(){var a=this.getPlugin();return a&&
a.jvms?!0:!1},isAutoUpdateEnabled:function(){return this.isPluginInstalled()?this.getPlugin().isAutoUpdateEnabled():!1},setAutoUpdateEnabled:function(){return this.isPluginInstalled()?this.getPlugin().setAutoUpdateEnabled():!1},setInstallerType:function(a){this.installType=a;return this.isPluginInstalled()?this.getPlugin().setInstallerType(a):!1},setAdditionalPackages:function(a){return this.isPluginInstalled()?this.getPlugin().setAdditionalPackages(a):!1},setEarlyAccess:function(a){this.EAInstallEnabled=
a},isPlugin2:function(){if(this.isPluginInstalled()&&this.versionCheck("1.6.0_10+"))try{return this.getPlugin().isPlugin2()}catch(a){}return!1},allowPlugin:function(){this.getBrowser();return"Safari"!=this.browserName2&&"Opera"!=this.browserName2},getPlugin:function(){this.refresh();var a=null;this.allowPlugin()&&(a=document.getElementById("deployJavaPlugin"));return a},compareVersionToPattern:function(a,b,e,c){if(void 0==a||void 0==b)return!1;var d=a.match("^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?$");
if(null!=d){var f=0;a=[];for(var g=1;g<d.length;++g)"string"==typeof d[g]&&""!=d[g]&&(a[f]=d[g],f++);d=Math.min(a.length,b.length);if(c){for(g=0;g<d;++g){if(a[g]<b[g])return!1;if(a[g]>b[g])break}return!0}for(g=0;g<d;++g)if(a[g]!=b[g])return!1;return e?!0:a.length==b.length}return!1},getBrowser:function(){if(null==this.browserName){var a=navigator.userAgent.toLowerCase();c("[getBrowser()] navigator.userAgent.toLowerCase() -\x3e "+a);-1!=a.indexOf("msie")&&-1==a.indexOf("opera")?this.browserName2=this.browserName=
"MSIE":-1!=a.indexOf("trident")||-1!=a.indexOf("Trident")?this.browserName2=this.browserName="MSIE":-1!=a.indexOf("iphone")?(this.browserName="Netscape Family",this.browserName2="iPhone"):-1!=a.indexOf("firefox")&&-1==a.indexOf("opera")?(this.browserName="Netscape Family",this.browserName2="Firefox"):-1!=a.indexOf("chrome")?(this.browserName="Netscape Family",this.browserName2="Chrome"):-1!=a.indexOf("safari")?(this.browserName="Netscape Family",this.browserName2="Safari"):-1!=a.indexOf("mozilla")&&
-1==a.indexOf("opera")?(this.browserName="Netscape Family",this.browserName2="Other"):-1!=a.indexOf("opera")?(this.browserName="Netscape Family",this.browserName2="Opera"):(this.browserName="?",this.browserName2="unknown");c("[getBrowser()] Detected browser name:"+this.browserName+", "+this.browserName2)}return this.browserName},testUsingActiveX:function(a){try{return null!=new ActiveXObject("JavaWebStart.isInstalled."+a+".0")}catch(b){return!1}},testForMSVM:function(){if("undefined"!=typeof oClientCaps){var a=
oClientCaps.getComponentVersion("{08B0E5C0-4FCB-11CF-AAA5-00401C608500}","ComponentID");return""==a||"5,0,5000,0"==a?!1:!0}return!1},testUsingMimeTypes:function(a){if(!navigator.mimeTypes)return c("[testUsingMimeTypes()] Browser claims to be Netscape family, but no mimeTypes[] array?"),!1;for(var b=0;b<navigator.mimeTypes.length;++b){s=navigator.mimeTypes[b].type;var e=s.match(/^application\/x-java-applet\x3Bversion=(1\.8|1\.7|1\.6|1\.5|1\.4\.2)$/);if(null!=e&&this.compareVersions(e[1],a))return!0}return!1},
testUsingPluginsArray:function(a){if(!navigator.plugins||!navigator.plugins.length)return!1;for(var b=navigator.platform.toLowerCase(),e=0;e<navigator.plugins.length;++e)if(s=navigator.plugins[e].description,-1!=s.search(/^Java Switchable Plug-in (Cocoa)/)){if(this.compareVersions("1.5.0",a))return!0}else if(-1!=s.search(/^Java/)&&-1!=b.indexOf("win")&&(this.compareVersions("1.5.0",a)||this.compareVersions("1.6.0",a)))return!0;return!1},IEInstall:function(){location.href=k((null!=this.returnPage?
"\x26returnPage\x3d"+this.returnPage:"")+(null!=this.locale?"\x26locale\x3d"+this.locale:"")+(null!=this.brand?"\x26brand\x3d"+this.brand:""));return!1},done:function(a,b){},FFInstall:function(){location.href=k((null!=this.returnPage?"\x26returnPage\x3d"+this.returnPage:"")+(null!=this.locale?"\x26locale\x3d"+this.locale:"")+(null!=this.brand?"\x26brand\x3d"+this.brand:"")+(null!=this.installType?"\x26type\x3d"+this.installType:""));return!1},compareVersions:function(a,b){for(var e=a.split("."),c=
b.split("."),d=0;d<e.length;++d)e[d]=Number(e[d]);for(d=0;d<c.length;++d)c[d]=Number(c[d]);2==e.length&&(e[2]=0);return e[0]>c[0]?!0:e[0]<c[0]?!1:e[1]>c[1]?!0:e[1]<c[1]?!1:e[2]>c[2]?!0:e[2]<c[2]?!1:!0},enableAlerts:function(){this.browserName=null;this.debug=!0},poll:function(){this.refresh();var a=this.getJREs();0==this.preInstallJREList.length&&0!=a.length&&(clearInterval(this.myInterval),null!=this.returnPage&&(location.href=this.returnPage));0!=this.preInstallJREList.length&&0!=a.length&&this.preInstallJREList[0]!=
a[0]&&(clearInterval(this.myInterval),null!=this.returnPage&&(location.href=this.returnPage))},writePluginTag:function(){var a=this.getBrowser();"MSIE"==a?document.getElementById("appletContainer").insertAdjacentHTML("afterbegin",'\x3cobject classid\x3d"clsid:CAFEEFAC-DEC7-0000-0001-ABCDEFFEDCBA" id\x3d"deployJavaPlugin" width\x3d"0" height\x3d"0"\x3e\x3c/object\x3e'):"Netscape Family"==a&&this.allowPlugin()&&this.writeEmbedTag()},refresh:function(){navigator.plugins.refresh(!1);"Netscape Family"==
this.getBrowser()&&this.allowPlugin()&&null==document.getElementById("deployJavaPlugin")&&this.writeEmbedTag()},writeEmbedTag:function(){var a=!1;if(null!=navigator.mimeTypes){for(var b=0;b<navigator.mimeTypes.length;b++)navigator.mimeTypes[b].type==this.mimeType&&navigator.mimeTypes[b].enabledPlugin&&(document.getElementById("appletContainer").insertAdjacentHTML("afterbegin",'\x3cembed id\x3d"deployJavaPlugin" type\x3d"'+this.mimeType+'" hidden\x3d"true" /\x3e'),a=!0);if(!a)for(b=0;b<navigator.mimeTypes.length;b++)navigator.mimeTypes[b].type==
this.oldMimeType&&navigator.mimeTypes[b].enabledPlugin&&document.getElementById("appletContainer").insertAdjacentHTML("afterbegin",'\x3cembed id\x3d"deployJavaPlugin" type\x3d"'+this.oldMimeType+'" hidden\x3d"true" /\x3e')}}};if(null==n.locale){d=null;if(null==d)try{d=navigator.userLanguage}catch(r){}if(null==d)try{d=navigator.systemLanguage}catch(t){}if(null==d)try{d=navigator.language}catch(u){}null!=d&&(d.replace("-","_"),n.locale=d)}return n}();f.installApplet=function(c,k,d,l){0==$("#appletContainer").length&&
$("body").append("\x3cdiv id\x3d'appletContainer'/\x3e");if(d)$(l).template("appletTempl"),k=$.template("appletTempl")($,{data:c}).join(""),$("#appletContainer").html(k);else{d=c.width||1;l=c.height||1;var h={code:c.appClass,archive:c.appletUrl,width:d,height:l};c={code:c.appClass,host:c.hostUrl,streamingServerUrl:c.streamingServerUrl,streamingServerPort:c.streamingServerPort,messageReceivingPort:c.messageReceivingPort,messageSendingPort:c.messageSendingPort,iam:c.cInfo,messageReceived:c.messageReceived,
separate_jvm:!0,noOfLinesToSync:c.noOfLinesToSync};k&&(c.test="true");f.runApplet(h,c,"1.6",d,l)}};f.writeObjectEmedTag=function(c,f,d,l){c="";null==d&&(l=d=1);c="\x3cparam name\x3d'separate_jvm' value\x3d'true' /\x3e";for(var h in f)c+="\x3cparam name\x3d'"+h+"' value\x3d'"+f[h]+"'/\x3e\n";var p=" separate_jvm \x3d'true' ";for(h in f)p+=h+"\x3d'"+f[h]+"' ";c="\x3cobject classid\x3d'clsid:8AD9C840-044E-11D1-B3E9-00805F499D93' width\x3d'"+d+"' height\x3d'"+l+"' codebase\x3d'http://java.sun.com/update/1.6.0/jinstall-6u30-windows-i586.cab#Version\x3d1,6,0,0'\x3e\n"+
c+"\n"+("\x3cembed type\x3d'application/x-java-applet;version\x3d1.6' width\x3d'"+d+"' height\x3d'"+l+"' ")+(p+"\x3e")+"\x3c/embed\x3e\n\x3c/object\x3e";$("#appletContainer").html(c)};f.getMinRequiredJavaVersion=function(c,f,d){f="1.6.0_21+";"macintosh"==d&&"safari"==c&&(f="1.6.0+");console.log("for os:"+d+",min java required is:"+f);return f};f.reloadApplet=function(){$("#appletContainer").hide().show()};f.removeApplet=function(){$("#appletContainer").remove()};return f})});