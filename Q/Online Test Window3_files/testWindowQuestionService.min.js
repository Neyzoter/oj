define2(["services/testWindowTimerService","services/testWindowTestStateService","services/testWindowConstants","services/navigationControlService"],function(){angular.module("mettl").register.service("TestWindowQuestionService",["TestWindowTimerService","TestWindowTestStateService","TestWindowConstants","$q","NavigationControlService",function(g,c,f,k,l){function h(a,b){if(c.testState.isTestStarted){var d=c.sectionState.current;a.StartTime&&a.SectionID==d.SectionID&&(a.TimeTaken+=a.StartTime-b,a.StartTime=
b)}}this.canGoToQuestion=function(a){var b=c.sectionState.current,d=b.CurrentItem,e=k.defer();l.isNavigationAllowed(f.NavigationAway.QUESTION).then(function(){!b.EnforceQuestionAttempt||!c.testState.isTestDisplayed||c.sectionState.timedOut.get(b.Index)||b.IsMultipleQuestions||a===d.Index+1&&d.IsAttempted||a<d.Index+1||b.Items[a-1].IsAttempted?e.resolve():e.reject({msg:"You are not allow to switch question.",mode:"compulsoryQuestion"})},e.reject);return e.promise};this.saveLastItem=function(){g.GetStatus()&&
h(c.itemState.current,g.GetTestTime())};this.beginItem=function(a,b){a.Status=f.Status.Started;a.StartTime=b};this.endItem=function(a,b){h(a,b);a.Status=f.Status.Completed;a.StartTime=null}}])});