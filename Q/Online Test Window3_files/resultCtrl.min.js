define2(["services/testWindowFactory","services/testWindowCommonUtils"],function(){angular.module("mettl").register.controller("ResultCtrl",["$scope","$http","$window","$log","$state","$timeout","TestWindowFactory","TestWindowCommonUtils",function(a,m,r,f,g,e,d,n){function p(){var b=d.test.isApi(),c=d.test.isPrivateInviteLink(),h=d.test.redirectUrl();a.showApiButton=(b||c)&&!(""==h||"/"==h)}function k(){window.location=d.test.redirectUrl();a.redirecting=!0}function l(){0<a.remainingTime?(a.remainingTime--,
e(l,1E3)):k()}if(a.$parent.initialised){a.$parent.isTestWindow=!1;a.candidateScore={score:-1};a.errorOccurred=!1;a.resultAvailable=!1;a.testName=d.test.getTestName();a.showReportLink=d.test.getShowReportLink();a.showResult=d.test.getShowResult();p();var q=d.test.getCandidateInstanceId();a.getCandidateResult=function(){m.get("/getCandidateResult?ciId\x3d"+q+"\x26flex\x3d"+Number(new Date)).success(function(b,c,d,f){c=b.candidateScore;a.candidateScore=c;b&&c&&c.assessmentScore&&(a.candidateScore.assessmentScore=
c.assessmentScore.toFixed(2));a.reportUrl=b.reportUrl;b=c.customMsg;if(c.resultAvailable||b)c=20,a.showApiButton&&(b&&(b=$("\x3cdiv\x3e\x3c/div\x3e").html(b).text(),b=b.split(" "),c=parseInt(4*b.length,10)),a.remainingTime=20>c?20:c,e(l,1E3))}).error(function(b,c,d,e){f.error(b);a.errorOccurred=!0;500==c&&g.go("error")})};a.closeWindow=function(){n.closeWindow()};a.redirectCandidate=k;a.stopApiInterval=function(){};window.onbeforeunload=function(){};a.getCandidateResult();e(function(){$(".modal").modal("hide").remove()},
100)}else f.log("redirecting to diagnostics"),g.go("diagnostics")}])});