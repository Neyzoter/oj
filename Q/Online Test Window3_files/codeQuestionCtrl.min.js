define2("controllers/baseQuestionCtrl services/testWindowTestStateService services/testWindowHelperService services/testWindowFactory services/testWindowCommonUtils services/codeQuestionService services/testWindowConstants directives/monacoEditorDirective".split(" "),function(){var w=angular.module("mettl");w.register.controller("codeQuestionCtrl",["$scope","$log","$stateParams","$state","$controller","$q","$window","$http","$compile","$timeout","TestWindowTestStateService","TestWindowHelperService",
"TestWindowFactory","TestWindowCommonUtils","CodeQuestionService","$interval","TestWindowConstants",function(b,s,r,w,y,t,ca,z,ya,D,A,Q,E,da,d,R,ea){function S(){b.isPreview=E.test.isPreview();try{H=JSON.parse(TEST_CODE_TEXT_8)}catch(a){H=TEST_CODE_TEXT_8}try{I=JSON.parse(TEST_CODE_TIMED_OUT)}catch(n){I=TEST_CODE_TIMED_OUT}b.expandWindow=!1;b.intellisense=!0;D(function(){b.monacoEditor.changeEditorSettings("intellisense",b.intellisense)});b.languages=d.getLanguageObjectForUi();b.editorData=d.getEditorSettings();
b.isAllowCopyPaste=A.testState.isAllowCopyPaste;b.showDefaultResult=c.Question.ShowDefaultResult;b.customCheckerEnabled=c.Question.CustomCheckerEnabled;b.currentPage=0;b.isIeBrowser=T;b.showPreviousCode=!1;if(A.testState.isPowerResume&&c.CompileUuid&&-1==c.CodeQuestionState.compileState&&!c.CodeQuestionState.checkCodeResults.length)e({editorState:"loading",keyUpTriggered:!0}),D(function(){J(c.CompileUuid,.5)},100);else{var m=d.getCodeLanguage();!c.IsAttempted&&m&&m!=c.CodeLanguage&&-1<c.Question.CodeLanguages.indexOf(m)&&
(e({editorState:"loading"}),U(m));c.CompileUuid=d.getCompileUuid(c.ItemID);d.setCodeLanguage(c.CodeLanguage)}b.compilationMessage=V();b.timedOutMessage=W(c.CodeLanguage.toUpperCase());m=[313149,306608,118232,94034];d.showWalkthroughTour()&&-1==m.indexOf(b.opts.clientId)&&setTimeout(function(){X(!1)},100);d.getWarningSyntaxData()||fa();c.CodeQuestionState.warningState&&setTimeout(function(){Y()},10)}function U(a){D(function(){var n=t.defer();K(a,n).then(function(){e({editorState:"loaded"})},function(){U(c.Question.CodeLanguages[0])})},
100)}function F(a){return a.split("mwhimper").map(function(a){return a.trim()})}function fa(){z({method:"GET",url:conf.getCodingSimulatorsWebServerUrl()+"codelysis/fetchComplileWarningSyntax",timeout:6E4}).success(function(a){var c=a.compileWarningSyntaxMap;a=a.compileWarningCategoriesMap;var b={},g;for(g in c){var q=c[g],k={};k.warningWordsList=F(q.warningWords);k.warningRegexList=F(q.warningRegex);k.commentsRegexList=F(q.commentsRegex);k.categoriesList=F(q.catagories);k.isReturnRequired=q.isReturnRequired;
b[g]=k}d.setWarningSyntaxData({categoryVsI18KeyMap:a,languageVsWarningsMap:b})}).error(function(a){console.log("error occured",a)})}function K(a,n){d.setCodeLanguage(a);z({method:"post",url:"/ccl",data:{i:c.ItemID,c:c.Skill_ClientID,l:a,v:c.QuestionVersion,ci:E.test.getCandidateInstanceId()},timeout:6E4}).success(function(m,g,q,k){if(m&&m.CodeTemplate){var v;try{v=da.htmlDecode(m.CodeTemplate),b.monacoEditor.changeLanguage(v,a)}catch(e){s.error("some error occurred while changing codelysis question template in ccl");
L(n,a);return}c.CodeLanguage=a;c.CodeTemplate=v;c.CodeQuestionState=d.getQuestionState(c.ItemID,!0);d.setCompileUuid(c.ItemID,"");c.CompileUuid="";c.Response=v;b.timedOutMessage=W(a.toUpperCase());n.resolve()}else L(n,a)}).error(function(c,b,q,k){L(n,a)});return n.promise}function W(a){return"KOTLIN"==a?TEST_CODE_TIMED_OUT_KOTLIN:"NODE"==a?TEST_CODE_TIMED_OUT_NODE:"SWIFT4"==a?TEST_CODE_TIMED_OUT_SWIFT4:I[a]}function V(){var a=c.CodeLanguage.toUpperCase();return"KOTLIN"==a?TEST_CODE_TEXT_8_KOTLIN:
"NODE"==a?TEST_CODE_TEXT_8_NODE:"SWIFT4"==a?TEST_CODE_TEXT_8_SWIFT4:H[a]}function L(a,c){A.testState.isTestEnding?a.reject():Q.Dialogue.ShowServerErrorMessage(function(){K(c,a)})}function X(a){h(!1);a&&f(l.walkThrough,{isStart:!0,codeLanguage:c.CodeLanguage});a=new Tour({debug:!0,storage:!1,backdrop:!0,autoscroll:!1,keyboard:!1,onStart:function(a){c.CodeQuestionState.showOutputArea=!1;$(document).bind("keydown",function(a){a.preventDefault()})},onEnd:function(a){a=a.getCurrentStep();$(document).unbind("keydown");
c.CodeQuestionState.showOutputArea=!0;d.setWalkthroughTour(!1);f(l.walkThrough,{isStart:!1,endOn:d.getWalkThroughEndId(a),codeLanguage:c.CodeLanguage,isLast:d.iswalkThroughEndStateLast(a)})},steps:d.getWalkthroughSteps(c.CodeLanguage,c.ItemID)});a.init(!0);a.start()}function ga(){var a,b;c.CodeQuestionState.showResetModal?(a=l.resetTemplate,b={codeLanguage:c.CodeLanguage,proceedClicked:!1}):c.CodeQuestionState.showLanguageChangeModal&&(a=l.languageChange,b={newLanguage:G,previousLanguage:c.CodeLanguage,
proceedClicked:!1});a&&f(a,b);c.CodeQuestionState.showLanguageChangeModal=!1;c.CodeQuestionState.showResetModal=!1}function ha(){e({editorState:"loading",panelStatus:"clear"});f(l.languageChange,{newLanguage:G,previousLanguage:c.CodeLanguage,proceedClicked:!0});var a=t.defer();K(G,a);h(!1);c.CodeQuestionState.showLanguageChangeModal=!1}function ia(){h(!1);c.CodeQuestionState.showResetModal=!0}function ja(){b.monacoEditor.changeLanguage(c.CodeTemplate,c.CodeLanguage);c.CodeQuestionState.showResetModal=
!1;f(l.resetTemplate,{codeLanguage:c.CodeLanguage,proceedClicked:!0})}function M(a,b){c.CodeQuestionState=d.getQuestionState(c.ItemID,!0);N("results",!1);e({compileState:0,compilationResult:"",panelStatus:"verifying",usingOwntestCases:b});c.IsAttempted||(c.IsAttempted=!0);B=!1;e({keyUpTriggered:!1});e({checkCodeResults:{compileResult:{compilationStatus:"COMPILING"}},compilationServerError:!1});z({method:"post",url:conf.getCodingSimulatorsWebServerUrl()+"codelysis/caec",data:a,timeout:6E4}).success(function(a,
b,n,k){a.Uuid?(d.setCompileUuid(c.ItemID,a.Uuid),c.CompileUuid=d.getCompileUuid(c.ItemID),e({poolingStartTime:Date.now()}),J(a.Uuid,.5)):Z()}).error(function(a,c,b,n){A.testState.isTestEnding||Z()});x=[]}function Z(){e({compilationServerError:!0,panelStatus:"show"})}function aa(){for(var a=0;a<x.length;a++)b.monacoEditor.showWarningLine(Number(x[a])+1)}function Y(){var a=c.CodeLanguage,b=c.Response,m={},g=[],q={},k=d.getWarningSyntaxData().languageVsWarningsMap[a];if(k){for(var a=k.warningWordsList,
v=k.warningRegexList,e=k.commentsRegexList,l=k.categoriesList,k=k.isReturnRequired,p=0;p<e.length;p++)for(var f=b.match(new RegExp(e[p],"gm"))||[],h=0;h<f.length;h++){for(var r=f[h],t=r,u=/\n/g,s="";null!==u.exec(t);)s+="\n";b=b.replace(r,s)}e=b.split(/\r?\n/);for(p=0;p<v.length;p++)for(f=a[p],h=l[p],r=new RegExp(v[p].trim()),t=0;t<e.length;t++)u=e[t].trim(),0!==u.length&&(u=u.replace(/\s+\(/g,"(").replace(/\s+>>/g,"\x3e\x3e"),r.test(u)&&(m.hasOwnProperty(h)||(m[h]=[]),u=m[h],-1==u.indexOf(f)&&u.push(f),
-1==g.indexOf(t)&&g.push(t)));k&&-1==b.indexOf("return")&&-1==b.indexOf("Return")&&(q.returnWarning=!0);q.catagoryVsWarningWordsList=m;q.lineNumbersWithWarnings=g}C=q;b=C.returnWarning;x=C.lineNumbersWithWarnings;if(x.length||b)aa(),O=c.CodeQuestionState.warningState=!0,ka()}function ka(){var a=angular.element("._check-code");a.popover({html:!0,template:'\x3cdiv class\x3d"warningMessage popover"\x3e\x3cbutton type\x3d"button" class\x3d"close _warningPopupClose"\x3e\x26times;\x3c/button\x3e\x3cdiv class\x3d"arrow"\x3e\x3c/div\x3e\x3cdiv class\x3d"popover-inner"\x3e\x3cdiv class\x3d"popover-content"\x3e\x3cp\x3e\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
content:function(){var a="",c=C.catagoryVsWarningWordsList,b;for(b in c)var q=c[b].join(", ")+" ",a=a+('\x3cdiv\x3e\x3cdiv class\x3d"icon-warning"\x3e\x3c/div\x3e \x3cspan\x3e'+q+"\x3c/span\x3e"+window[d.getWarningSyntaxData().categoryVsI18KeyMap[b]]+"\x3c/div\x3e");C.returnWarning&&(a+='\x3cdiv\x3e\x3cdiv class\x3d"icon-warning"\x3e\x3c/div\x3e'+window[d.getWarningSyntaxData().categoryVsI18KeyMap["return"]]+"\x3c/div\x3e");return a}()+'\x3cbutton type\x3d"button" id\x3d"close" class\x3d"btn btn-xs btn-primary _ignoreAndProceed"\x3e'+
CODELYSIS_WARNING_IGNORE_AND_PROCEED+"\x3c/button\x3e",placement:"top",container:".codelysis-bottom-menu"});a.popover("show");angular.element("._warningPopupClose").bind("click",function(){f(l.ignoreAndProceed,{codeLanguage:c.CodeLanguage,proceedDone:!1});h(!1)});angular.element("._ignoreAndProceed").bind("click",function(){c.CodeQuestionState.codejsonData&&(f(l.ignoreAndProceed,{codeLanguage:c.CodeLanguage,proceedDone:!0}),h(!1),M(c.CodeQuestionState.codejsonData,c.CodeQuestionState.ownTestCaseData))})}
function ba(a){b.expandWindow=a||!b.expandWindow;b.monacoEditor.resizeEditor();h(!1);f(l.fullScreen,{codeLanguage:c.CodeLanguage,isFullScreen:b.expandWindow})}function h(a){O&&a&&(O=!1,x=[],b.monacoEditor.createEditor(b.item.Response||"",b.item.CodeLanguage,!1,!1));c.CodeQuestionState.warningState=!1;angular.element("._check-code").popover("destroy")}function N(a,n){"verifying"!=c.CodeQuestionState.panelStatus&&c.CodeQuestionState.currentTab!=a&&(n&&"results"===a&&(b.showPreviousCode=!1,f(l.resultsTabClicked,
{codeLanguage:c.CodeLanguage})),e({currentTab:a}),hasCodeChanged=c.CodeQuestionState.checkCodeResults.compileResult&&c.CodeQuestionState.checkCodeResults.compileResult.candidateCode&&"results"==c.CodeQuestionState.currentTab&&c.CodeQuestionState.keyUpTriggered&&0<=c.CodeQuestionState.compileState,e({hasCodeChanged:hasCodeChanged}),"code"===a&&(b.monacoEditor.createEditor(b.item.Response||"",b.item.CodeLanguage,!1,!1),setTimeout(aa,300)))}function f(a,n){a&&b.$emit(a,{category:"codelysis",action:a,
data:new d.createGaData(c.ItemID,n)})}function la(){angular.forEach(c.CodeQuestionState.checkCodeResults.rowValues,function(a){"InProgress"==a.testCaseStatus&&(a.testCaseStatus="Stopped")});B=!0;e({panelStatus:"show",testCasesStopped:!0,defaultTestCasesStatus:"stopped",nonDefaultTestCasesStatus:"stopped"})}function ma(){var a=!1;angular.forEach(c.CodeQuestionState.checkCodeResults.rowValues,function(c){"InProgress"!=c.testCaseStatus||a||(a=!0)});return a}function na(){return c.CodeQuestionState.timeLimitReached?
"TimeLimitReached":c.CodeQuestionState.compilationServerError?"Failed":"InProgress"}function oa(){return c.CodeQuestionState.timeLimitReached?TEST_CODE_TEXT_33:c.CodeQuestionState.compilationServerError?TEST_CODE_TEXT_34:c.CodeQuestionState.checkCodeResults.compileResult.isScriptingLanguage?PARSING_IN_PROGRESS:COMPILING_IN_PROGRESS}function pa(a){return c.CodeQuestionState.usingOwntestCases?"icon-user":"icon-"+a}function qa(a){return(a?100:50)+"%"}function ra(a){return(108<a?a-108:332)+"px"}function sa(a){b.currentPage+=
a}function ta(a){c.CodeQuestionState.activeTCIndex=a;b.currentPage=parseInt(a/6)}function e(a){angular.forEach(a,function(a,b){d.setQuestionState(c.ItemID,b,a);c.CodeQuestionState[b]=a})}function J(a,b){D(function(){var b=(new Date).getTime(),b={uuid:a,ciid:A.candidate.id,ts:b},n={currentTime:Date.now()};e(n);B||(18E4<c.CodeQuestionState.currentTime-c.CodeQuestionState.poolingStartTime?ua():z({method:"post",url:conf.getCodingSimulatorsWebServerUrl()+"codelysis/fetchCodeTestCaseResult",data:b,timeout:6E4}).success(function(b){var n=
va(b),m={compileState:n.cState};n.inProgress?J(a):m.panelStatus="show";c.CodeQuestionState&&"loading"==c.CodeQuestionState.editorState&&(m.editorState="loaded");b.rowValues=1==m.compileState?b.defaultTestCasesResult:b.nonDefaultTestCaseResult;var g={showOutputArea:!0,checkCodeResults:b,defaultTestCasesResult:b.defaultTestCasesResult,nonDefaultTestCaseResult:b.nonDefaultTestCaseResult};b&&b.compileResult&&b.compileResult.isOwnTestcase&&(g.usingOwntestCases=b.compileResult.isOwnTestcase);angular.extend(m,
g);e(m);n.dataNotFound&&(B=!0,N("code",!1))}).error(function(a){c.CodeQuestionState=d.getQuestionState(c.ItemID,!0)}))},1E3*(b||5))}function ua(){angular.forEach(c.CodeQuestionState.checkCodeResults.rowValues,function(a,c){"InProgress"==a.testCaseStatus&&(a.testCaseStatus="TimeLimitReached")});B=!0;e({panelStatus:"show",timeLimitReached:!0,defaultTestCasesStatus:"TimeLimitReached",nonDefaultTestCasesStatus:"TimeLimitReached"})}function va(a){if(a&&"DataNotFound"==a.codeProcessResultStatus)return{cState:-1,
inProgress:!1,dataNotFound:!0};var c=a.compileResult;if(!c||"COMPILING"==c.compilationStatus)return{cState:0,inProgress:!0};if("COMPILATION_FAILED"==c.compilationStatus||!c.defaultTestCaseIndexCSV&&!c.nonDefaultTestCaseIndexCSV)return{cState:0,inProgress:!1};var b,g=!1,d="running",k="running";b=a.nonDefaultTestCaseResult&&a.nonDefaultTestCaseResult.length?2:a.defaultTestCasesResult&&a.defaultTestCasesResult.length?1:0;var g=c.isOwnTestcase,f=c.defaultTestCaseIndexCSV.split(",").length,c=c.nonDefaultTestCaseIndexCSV.split(",").length,
h=f,l=c;if(g)if(f!=a.defaultTestCasesResult.length)g=!0;else var p=P(a.defaultTestCasesResult,1==b,h),g=p.inProgress,d="passed",h=p.progressCount;else f!=a.defaultTestCasesResult.length?g=!0:(p=P(a.defaultTestCasesResult,1==b,h),g=p.inProgress,d=p.status,h=p.progressCount,g||"passed"!=d||(c!=a.nonDefaultTestCaseResult.length?g=!0:(p=P(a.nonDefaultTestCaseResult,2==b,l),g=p.inProgress,k=p.status,l=p.progressCount)));a={};a.defaultTestCasesStatus=d;a.nonDefaultTestCasesStatus=k;a.dWidth=100*(0<f?(f-
h)/f:0);a.nDWidth=100*(0<c?(c-l)/c:0);e(a);return{cState:b,inProgress:g}}function P(a,c,b){var d=!1,f;angular.forEach(a,function(a){c&&a&&"InProgress"==a.testCaseStatus?d=!0:b--;var e=f;!d&&a&&(e="Pass"==a.testCaseStatus&&"failed"!=e?"passed":"failed");f=e});return{inProgress:d,status:f,progressCount:b}}function wa(){var a=c.CodeQuestionState.compileState,b=c.CodeQuestionState.nonDefaultTestCasesStatus,d=c.CodeQuestionState.defaultTestCasesStatus;return"running"==d?TEST_CODE_TEXT_30:1==a&&"running"!=
d||2==a&&"running"!=b?TEST_CODE_TEST_CASE_RESULTS:TEST_CODE_TEXT_31}y("baseQuestionCtrl",{$scope:b,$stateParams:r});ca.mad&&require2(["controllers/drrCtrl"],function(){y("drrCtrl",{$scope:b})});var c=b.item;if(c){var H,I,B=!1,G,C=null,O=!1,x=[],l=ea.Events.Codelysis;c.CodeQuestionState=d.getQuestionState(c.ItemID);var T=!1;r=navigator.userAgent.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];/trident/i.test(r[1])&&(T=!0);if(window.MonacoLCWrapper)S();else{e({editorState:"loading"});
var xa=R(function(){window.MonacoLCWrapper&&(R.cancel(xa),e({editorState:"loaded"}),S())},500)}b.changeLanguage=function(a){if(c.CodeLanguage==a)return!1;h(!1);c.CodeQuestionState.showLanguageChangeModal=!0;G=a};b.cancelChange=ga;b.proceedLanguageChange=ha;b.resetDefaultTemplate=ia;b.proceedResetTemplate=ja;b.startCodeWalkThrough=X;b.killWarningPopup=h;b.tabChange=N;b.changeEditorSettings=function(a,c,e){b.monacoEditor.changeEditorSettings(a,c);d.setEditorSetting(a,c);h(!1);f(l.editorSettings,{settingType:a,
settingValue:c});e.stopPropagation()};b.toggleIntellisense=function(a){b.intellisense=a;b.monacoEditor.changeEditorSettings("intellisense",a);f(l.editorSettings,{settingType:"intellisenseOn",settingValue:a})};b.checkCode=function(a){f(l.compileAndTest,{codeLanguage:c.CodeLanguage});var d=!1,e={c:b.monacoEditor.getEditorContent(),i:c.ItemID,s:c.Skill_ClientID,l:c.CodeLanguage,a:E.test.getAssessmentId(),ci:E.test.getCandidateInstanceId(),v:c.QuestionVersion,u:[]};if(c.useCandidateTestCaseValue)for(var d=
!0,g=0;g<c.candidateTestCaseValues.length;g++){var q=$.trim(c.candidateTestCaseValues[g]);if(q)e.u.push(q);else return Q.Dialogue.ShowAlert({message:"Testcase input "+(g+1)+" value should not be empty."}),!1}c.CodeQuestionState.codejsonData=e;c.CodeQuestionState.ownTestCaseData=d;try{Y(),c.CodeQuestionState.warningState?a.stopImmediatePropagation():(h(!1),M(e,d))}catch(k){console.log("Error occured in fetching language warning data",k),M(e,d)}b.compilationMessage=V()};b.codeArea={keydown:function(a){var b;
window.event?b=a.keyCode:a.which&&(b=a.which);32===b&&a.ctrlKey&&f(l.controlSpace,{codeLanguage:c.CodeLanguage});112===b&&f(l.editorF1,{codeLanguage:c.CodeLanguage});"m"==String.fromCharCode(b).toLowerCase()&&a.ctrlKey?ba(!0):h(!1)},keyup:function(){b.monacoEditor.focusInHandler();b.item.IsAttempted=b.item.IsAttempted||$.trim(b.item.Response)!=$.trim(b.item.CodeTemplate);h(!0);e({keyUpTriggered:!0})}};b.changeCompilingState=function(a,b){if(!b)return!1;e({compileState:a});c.CodeQuestionState.checkCodeResults.rowValues=
1==a?c.CodeQuestionState.defaultTestCasesResult:c.CodeQuestionState.nonDefaultTestCaseResult};b.togglePreviousCodeEditor=function(){b.showPreviousCode=!b.showPreviousCode;f(l.previousCodeEditor,{isShown:b.showPreviousCode,codeLanguage:c.CodeLanguage})};b.toggleUseOwnTestCase=function(){c.useCandidateTestCaseValue=!c.useCandidateTestCaseValue;f(l.yourTestCase,{codeLanguage:c.CodeLanguage,isChecked:c.useCandidateTestCaseValue})};b.resizeEditor=ba;b.stopRunningTestCases=la;b.showStopButton=ma;b.getCompilationClass=
na;b.getCompilationText=oa;b.getTestCaseIconClass=pa;b.getCompilationWidth=qa;b.getAvailableHeight=ra;b.changeCurrentPage=sa;b.updateActiveTestCaseIndex=ta;void 0===c.useCandidateTestCaseValue&&(c.useCandidateTestCaseValue=!1);void 0===c.candidateTestCaseValues&&(c.candidateTestCaseValues=[]);b.getCompileStateText=wa;b.getMessageFromCustomCheckerResult=function(a){return JSON.parse(a).message};b.isErrorFromCustomCheckerResult=function(a){return JSON.parse(a).isError};b.$on("$destroy",function(){monacoUtils.closeLspWebSocket()})}}]);
w.register.filter("languageRangeFilter",["$log",function(b){return function(b,r,w){if(!r)return b;var y=[];r=r.trim().toUpperCase();angular.forEach(b,function(b){var s=b=b.toUpperCase();try{s=w[s].label}catch(z){s=b}-1!==s.indexOf(r)&&y.push(b)});return y}}]);w.register.filter("startFrom",function(){return function(b,s){return b.slice(+s)}})});