define2(["plugin/common-plugins/monaco-mettl","plugin/common-plugins/lsp-metric-sender"],function(){angular.module("mettl").register.directive("monacoEditor",[function(){return{restrict:"A",link:function(c,t,p){function g(a){c.item.Response=a||monacoUtils.getEditorValue()}function q(a){k.addMetric(a)}function l(){k.stop()}function b(a,r,d,b){var e;monacoUtils.clearEditorOptions();var f={mettlStaticUrl:conf.getStaticServerUrl(),rightClickAllowed:!1,isReadOnly:d,otherKeyMapsNeeded:!d,readOnlyRegionNeeded:!d,
editorDomId:d?"readonly-editor-container":"monaco-container",metricsHandlerOptions:{handleMetrics:q,stopSendingMetric:l}};d||(f.lspWsServerUrl=conf.lspWsServerUrl,f.monacoClientUrl=conf.monacoClientUrl,f.onContentChangeHandler=g);b?(e=b=!0,f.createNewLsp=!0):(e=b=!1,f.createNewLsp=!1);monacoUtils.createEditor(a,r,b,e,f);d||setTimeout(function(){monacoUtils.applyEditorHandlers(m,!c.isAllowCopyPaste)})}var k=new LspMetricSenderUtil.LspMetricSender(conf.getCodingSimulatorsWebServerUrl()+"codelysis/lspMetrics",
1E4);if("previouscode-editor"===p.type){var e,h;try{var n=c.item.CodeQuestionState.checkCodeResults.compileResult;e=n.candidateCode;h=n.codeLanguage}catch(s){console.log("Error in retrieving data for readonly editor creation. Error: ",s),h=e=""}b(e,h,!0,!1)}else b(c.item.Response||"",c.item.CodeLanguage,!1,!0);var m=function(){c.item.IsFocused=!0};c.$parent.monacoEditor={resizeEditor:function(){setTimeout(function(){monacoUtils.resizeEditor()})},changeLanguage:function(a,c){g(a);b(a,c,!1,!0)},setValueInEditor:function(a){g(a);
monacoUtils.setEditorValue(a)},changeEditorSettings:function(a,b){if(a&&!(-1<["",null,void 0].indexOf(b)))try{c.editorData[a]=b,monacoUtils.changeEditorSettings(a,b)}catch(d){console.log("Error in changing editor settings. Setting type: ",a," , Setting Value: ",b,". Error: ",d)}},createEditor:b,focusInHandler:m,getEditorContent:monacoUtils.getEditorValue,showWarningLine:monacoUtils.showWarningLine};c.$on("$destroy",function(){l()})}}}])});