define2(["services/testWindowConstants","services/resourceLoaderService"],function(){var k=angular.module("mettl");k.register.directive("i18Text",function(){return{restrict:"AE",scope:{i18Text:"@",i18Title:"@",i18Tag:"@"},link:function(u,e,m){m.$observe("i18Tag",function(b){if(b=window[b]){try{e.html(b)}catch(m){$(e).html(b)}"OPTION"==e[0].tagName&&e.attr("label",b)}});m.$observe("i18Title",function(b){b&&e.attr("title",window[b])})}}});k.register.directive("questionText",["$log","$compile","$timeout",
"ResourceLoaderService","TestWindowConstants",function(u,e,m,b,x){return{restrict:"A",link:function(a,b,c){var d="",m=!1;try{d=a.$eval(c.text),!d&&!b.hasClass("_option-text")&&a.item&&a.item.Question&&(d=a.item.Question.QuestionText)}catch(u){}if(d){var q=!1;if(d.match(".*\\\x3c[^\x3e]+\x3e.*")){var k=function(a){r=r.filter(function(b){return b!==a})},v=function(a,b){0<b?(a.parents("._media-elements").find("._noOfPlayTime").html(b),1==b&&(a.parents("._media-elements").find("._time-text").addClass("text-warning"),
a.parents("._media-elements").find("._playTimeText").text("time"))):(a.attr("src",""),a.parents("._media-elements").find("._media-play-time .icon-info").removeClass("media-info-black").addClass("media-info-red"),a.parents("._media-elements").find("._question-count-number").addClass("text-danger").text("Maximum play limit reached. You cannot play this media anymore."))},d='\x3cdiv class\x3d"text-tags '+(c.questionClass||"")+'"\x3e'+d+"\x3c/div\x3e",d=d.replace(/{{/gi,"{ { ").replace(/}}/gi," } }");
c=$("\x3cdiv\x3e\x3c/div\x3e").html(d);c=c.find("*:not(img)").removeAttr("style");var g=c.find("img"),q=0<g.length,n=!1,s,w=!1,r=[];0<b.parents("._question-body").length&&(s=c.find("audio"),n=0<s.length);0<=c.find("._edit-delete-setting").length&&$("._edit-delete-setting").remove();!a.isMultipleQuestions&&n&&(a.item.MediaPlayAttempts||(a.item.MediaPlayAttempts=function(a,b){for(var l=[],f=0;f<a;)l[f++]=b;return l}(s.length,0)),angular.element("._question-body").each(function(b,c){s.each(function(l,
f){f.addEventListener("loadedmetadata",function(f){var c=0,d=0;f=angular.element("._question-body").eq(b).find("."+f.target.className);var g=f.eq(l),e=g.parents("._media-elements");e.find("._time-text").addClass("text-success");if(0<e.find("._media-play-time").length){e=e.find("._noOfPlayTime").html()-a.item.MediaPlayAttempts[l];v(g,e);var h=f[l];h.addEventListener("pause",function(a){m||h.ended?(h.pause(),k(l)):h.play()});h.addEventListener("timeupdate",function(){h.seeking||(c=h.currentTime)});
h.addEventListener("seeking",function(a){!w&&.01<Math.abs(h.currentTime-c)&&(h.currentTime=c)});h.addEventListener("play",function(b){$(b.target)&&(r.push(l),d+=1,1==d&&(b=$(b.target).parents("._question-body").find("._media-elements").index($(b.target).parents("._media-elements")),a.item.MediaPlayAttempts[b]+=1),console.log("Audio Played"))});h.addEventListener("ended",function(a){a=a.target;d=c=0;a=$(a);var b;b=a.parents("._media-elements").find("._noOfPlayTime").html();b--;v(a,b);k(l);console.log("Audio Ended")})}});
a.$on("$destroy",function(){m=!0,f.pause(),k(l)})})}));a.$on("mediaRecordingStarted",function(a,b){for(var c=document.getElementsByClassName("_audioTag"),f=0;f<c.length;f++){(w=b)&&(0<$(c[f]).parents("._media-elements").find("._media-play-time").length?-1<r.indexOf(f):1)&&(isNaN(c[f].duration)||Infinity===c[f].duration?c[f].currentTime=3E4:c[f].currentTime=c[f].duration);var d=c[f],e=b;$(d).css("pointer-events",e?"none":"");$(d).parents("._media-elements").css("opacity",e?"0.5":"1");$(d).parents("._media-elements").css("cursor",
e?"not-allowed":"normal")}});if(q){var p=a.item.questionImages;a.item.questionImages.applying?g.each(function(a,b){$(this).attr("src","").attr("ng-src","{{$parent.item.questionImages.images["+a+"].src}}")}):(p.total+=g.length,a.isMultipleQuestions||a.$emit(x.Events.Question.QuestionImagesLoading),g.each(function(a,b){var c=$(this),d=c.attr("src");p.images.push({index:p.images.length,image:this,src:d,baseUrl:d});c.attr("src","").attr("ng-src","{{$parent.item.questionImages.images["+(p.images.length-
1)+"].src}}")}))}g=c.find("a");if(n=0<g.length)for(var t=0;t<g.length;t++)$(g[t]).attr("target","_blank");if(q||n)d=c.html()}else d='\x3cpre class\x3d"text-only '+(c.questionClass||"")+'"\x3e'+d+"\x3c/pre\x3e";if(a.items)for(c=0;c<a.items.length;c++)if("FITB"==a.items[c].DisplayType)for(g=a.items[c].Response,a.items[c].blanks=g?g.split(","):[],g=0==a.items[c].blanks.length,n=0;d.match("#blank#");)g&&a.items[c].blanks.push(""),d=d.replace("#blank#",'\x3cinput class\x3d"fitb" type\x3d"text" ng-model\x3d"items['+
a.item.Index+"].blanks["+n+']" autocomplete\x3d"off" ng-style\x3d"items['+a.item.Index+"].styles["+n+']" ng-change\x3d"onKeyupFitb('+n+", "+a.item.Index+')" /\x3e'),n++;b.html(d);e(b.contents())(a);q&&!a.item.questionImages.applying&&angular.forEach(a.item.questionImages.images,function(b,c){b.loaded||a.item.questionImages.loadQuestionImage(a.item.Index,c)})}else b.html("\x26nbsp;")}}}]);k.register.directive("calculator",["$log","TestWindowConstants","TestWindowFactory",function(k,e,m){e={};var b=
!1;e.restrict="AE";e.link=function(e,a){if(e.testWindow&&e.testWindow.Assessment.UiSettings.ShowScientificCalculator){var y=m.isAllowedNewCalculator();!b&&y?require(["plugin/jquery/oscZenoedited"],function(){k.log("calculator css loaded");b=!0}):b?clearCalc():(require(["plugin/jquery/CalcSS3"],function(){k.log("calculator css loaded");b=!0}),console.log("Old Calc"))}};return e}])});