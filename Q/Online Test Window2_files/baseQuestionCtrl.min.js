define2("services/testWindowTestStateService services/testWindowTimerService services/testWindowConstants services/resourceLoaderService services/navigationControlService services/testWindowHelperService".split(" "),function(){angular.module("mettl").register.controller("baseQuestionCtrl",["$scope","$rootScope","$stateParams","$http","$timeout","TestWindowTimerService","TestWindowTestStateService","TestWindowQuestionService","TestWindowConstants","ResourceLoaderService","TestWindowFactory","NavigationControlService",
"TestWindowHelperService","$q","$interval",function(a,D,w,M,x,E,k,F,l,G,H,I,N,y,s){function J(a){a&&-1<["MCQ","MCA"].indexOf(a.DisplayType)&&(a.uiPositions=[],h.RandomizeOptions?a.uiPositions=a.UiPositions:angular.forEach(a.Answers,function(c,p){a.uiPositions.push(p)}))}function O(){var a=$("._ques-dragger"),c=$("._ques-description"),p,b;0!=a.length&&a.draggable({start:function(){p=c.height();b=$("._ques-text-wrapper").height()+20},drag:function(d,e){if(p>=b)return a.css({top:0}),!1;var f=p+(e.position.top-
e.originalPosition.top);60<f&&c.css("maxHeight",f);a.css({top:0})},axis:"y"})}function P(){$("._questionsWrapper").on("keydown",function(a){9==a.keyCode&&a.preventDefault()})}function K(g){a.item=g;b=a.item.Question.DisplayTypeId;if(t=a.isMultipleQuestions?!(1!=b&&5!=b&&7!=b):!(1!=b&&4!=b&&5!=b&&7!=b&&15!=b&&2!=b&&6!=b&&18!=b&&19!=b&&20!=b&&21!=b&&22!=b))a.item.twoColumnLayout=!0}function L(g){a.item=g;a.item.questionImages={error:!1,informed:!1,total:0,images:[],time:(new Date).getTime(),applying:!1,
counter:{completed:0,error:0,success:0,reloads:0},refresh:function(){this.counter.completed=this.counter.error=this.counter.success=0},loadQuestionImage:function(c,g){function b(){f.completed++;if(f.completed==e.total)if(0<f.error)a.$apply(function(){e.applying=!0;e.error=!0});else{var c=(new Date).getTime()-e.time;a.isMultipleQuestions||a.$emit(l.Events.Question.QuestionImagesLoaded);x(function(){e.applying=!0},3E3<c?10:3E3-c)}}var d=this.images[g].src,e=a.items[c].questionImages,f=e.counter;G.isImageLoaded(d)?
(f.success<e.total&&(f.success++,f.completed++,this.images[g].loaded=!0),f.completed==e.total&&a.$emit(l.Events.Question.QuestionImagesLoaded)):x(function(){G.loadImage(d,function(){f.success<e.total&&(f.success++,e.images[g].loaded=!0);b()},function(){f.error++;cn.neyzoter.test.isPreview()||a.items[c].questionImages.informed||1!=a.items[c].questionImages.counter.reloads||(M.post(l.Url.informSupport,{ck:cn.neyzoter.test.getCandidateKey(),reason:"loadFailure",type:"image",s:k.sectionState.currentIndex,i:k.itemState.currentIndex}),
a.items[c].questionImages.informed=!0);b()})},10)},onImageLoadRetry:function(c){this.counter.reloads++;a.$emit(l.Events.Question.QuestionReload,{data:{type:"image",reLoadAttempt:this.counter.reloads},category:"errorRR",action:"questionReload"});this.refresh();for(var g=0;g<this.images.length;g++){var b=this.images[g];b.src=b.baseUrl+"?v\x3d"+this.counter.reloads;this.loadQuestionImage(c,g)}},hasImagesLoaded:function(c){return 0==a.items[c].questionImages.total||0<a.items[c].questionImages.total&&
a.items[c].questionImages.counter.success==a.items[c].questionImages.total},loadingImage:function(c){return 0<a.items[c].questionImages.total&&a.items[c].questionImages.counter.success<a.items[c].questionImages.total}}}function z(){!d||0>=d||a.item.TimeTaken>h.MinimumQuestionTime?u=!1:k.testState.isTestProctorPaused||(0<a.item.TimeTaken&&a.item.TimeTaken<d&&(d-=a.item.TimeTaken),n&&s.cancel(n),n=s(function(){var a=parseInt(d/3600,10),c=parseInt((d-3600*a)/60,10),b=parseInt(d-3600*a-60*c,10);A=(10>
a?"0"+a:a)+":"+(10>c?"0"+c:c)+":"+(10>b?"0"+b:b);angular.element("._minQuestionTimer").html(A);0>--d&&(n&&s.cancel(n),u=!1,v&&(v=!1,q.HideSpecific(q.Type.MIN_QUESTION_TIME),r.resolve()))},1E3))}function Q(b){switch(b){case m.QUESTION:case m.SECTION:return r=y.defer(),!d||0>=d||a.item.TimeTaken>h.MinimumQuestionTime||!u?r.resolve():(v=!0,q.ShowAlert({title:"Caution",message:MIN_QUESTION_TIME_NAV_TEXT,type:q.Type.MIN_QUESTION_TIME,priority:q.Priority.MIN_QUESTION_TIME,actions:["OK"],callback:function(){v=
!1;B(b)}}),angular.element("body").find(".modal-backdrop").css({opacity:"0.8"}),angular.element("._minQuestionTimer").html(A),r.reject("Navigation not allowed. Minimum time to spend on the question in not over.")),r.promise;case m.INTERNET_DISCONNECTION:case m.PROCTOR_PAUSED:n&&s.cancel(n);B(b);var c=y.defer();c.resolve();return c.promise;default:return c=y.defer(),c.reject("Invalid mode found for getting Min Question Time Handler. Mode: ",b),c.promise}}function B(a){I.addHandler(function(){return Q(a)},
a)}function R(){for(var a=0;a<C.length;a++)B(C[a])}var h=a.$parent.section,t,b,q=N.Dialogue,m=l.NavigationAway,C=[m.QUESTION,m.SECTION,m.INTERNET_DISCONNECTION,m.PROCTOR_PAUSED],d=h.MinimumQuestionTime,n,A,v=!1,r,u=h.IsMinimumQuestionTime;if(h){a.isMultipleQuestions=h.IsMultipleQuestions;992>document.documentElement.clientWidth&&(h.IsMultipleQuestions=!1);a.items=h.Items;a.enforceQuesAttempt=h.EnforceQuestionAttempt;a.getItem=function(b){return a.items[b]};a.item=a.getItem(w.i);a.isMultipleQuestions?
angular.forEach(a.items,J):J(a.item);a.index=w.i+1;a.responded=!1;a.$parent.currentItem=a.getItem(w.i);a.getTimeSpentPerQuestion=function(){k.itemState.current&&F.endItem(k.itemState.current,E.GetTestTime());k.sectionState.current.CurrentItem=a.item;k.itemState.setCurrent(a.item);F.beginItem(k.itemState.current,E.GetTestTime())};a.getTimeSpentPerQuestion();a.$watch(function(a){return a.items.map(function(a){return a.IsAttempted})},function(b,c){b!=c&&a.$parent.setAttempted(a.item)},!0);a.isMultipleQuestions?
(angular.forEach(a.items,L),angular.forEach(a.items,K)):(L(a.item),K(a.item));18!=b&&992>document.documentElement.clientWidth&&(t=!1);a.opts.hideParentScroll=t&&!a.isMultipleQuestions;if(t||a.isMultipleQuestions)a.availableScreenHeight=document.documentElement.clientHeight-a.sectionAdjustment;x(function(){O();a.isMultipleQuestions&&P()},2E3);a.calculatorImage=conf.getStaticServerUrl()+"/resources/images/Calc.png";$("._calc-main").removeClass("calc-show");D.$on(l.PR_SOURCE.CONNECTION_RESTORED,z);D.$on(l.PR_SOURCE.TEST_RESUMED,
z);u&&(R(),z());a.$on("$destroy",function(){a.$emit(l.Events.Question.QuestionImagesLoaded);I.clearNavigationHandlers(C)})}}])});